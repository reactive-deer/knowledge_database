### FRR (FRRouting)

---

**FRRouting (FRR)** - это набор протоколов IP-маршрутизации для платформ Linux и Unix, который включает демоны протоколов для BGP, IS-IS, LDP, OSPF, PIM и RIP.



#### Установка

* **Debian**

  ```
  apt isntall frr
  ```

* **CentOS**

  ```
  dnf install frr
  ```

#### Файлы

* **/etc/frr/** - директория с конфигурационными файлами
* **/etc/frr/daemons** - вкл/откл необходимых протоколов (в виде демонов)
* **/etc/frr/frr.conf** - единая точка хранения настроек выполненных в **vtysh** (может быть разрознена)
* **/usr/share/doc/frr** - документация
  * **./examples/** - примеры конфигураций протоколов (демонов)



#### Конфигурирование

1. Для работы с FRR необходимо включить требующиеся протоколы, для это в файле **/etc/frr/daemons** изменяем состояние демонов с *no* на *yes*.

   * Для **CentOS**, необходимо кроме требуемых протоколов, **включить** так же демон **zebra**.

   ```shell
   bgpd=no
   ospfd=yes
   ospf6d=no
   ripd=no
   ripngd=no
   isisd=no
   ...
   ```

2. Закрываем файл и запускаем **FRR**.

   ```
   systemctl start frr
   ```

   * Для **Centos**, необходимо добавить **FRR** в автозагрузку, потому что, по-умолчанию утилита находится в состоянии *disable*.

     ```
     systemctl enable frr
     ```

     

#### Использование VTYSH

***vtysh*** - это оболочка для демонов FRR. Она объединяет все команды CLI, определенные в каждом из демонов, и представляет их пользователю в единой оболочке, что избавляет пользователя от необходимости подключаться к каждому из демонов через Telnet и использовать их индивидуальные оболочки. Объединение достигается путем извлечения команд из демонов и их инъекции в VTYSH во время сборки.



Для запуска необходимо ввести в окне терминала `vtysh`.

После откроется **CLI**, практически индентичная **CLI IOS**. Команды поддерживают использование **Tab**, комбинация `Shift + ?` выдает список доступных команд и др.



#### Конфигурирование OSPF

Настройки идентичны таковым в устройствах **Cisco**.

```shell
conf t
router ospf
 ospf router-id 3.3.3.100		# Для более удобной идентификации
 passive-interface ens38		# Интерфейс в Интернет
 network 10.5.5.0/30 area 0		# Сеть туннеля
 network 172.16.20.0/24 area 0	# Локальные сети
 network 172.16.50.0/30 area 0
 network 172.16.55.0/30 area 0
```

Также, необходимо изменить еще несколько пунктов:

* **FRR** в своем конфигурационном файле изначально хранит команду **no ip forwarding** / **no ipv6 forwarding**, что приводит к конфликту с настройками ОС (**sysctl.conf**), чтобы это изменить, необходимо в режиме глобальной конфигурации указать данные команды без преписки ***no***.

  ```
  L-FW(config)# ip forwarding
  ```

* На машинах под управлением **CentOS**, при сохранении конфигурации, настройки будет разбиты по разным файлам и иметь названия демонов к которым относятся (например, **ospfd.conf**). Чтобы перевести всю конфигурацию для хранения в один файл, необходим воспользоваться командой:

  ```
  L-FW(config)# service integrated-vtysh-config
  ```

  

После чего ***следует сохранить произведенные настройки*** при помощи команды **wr** в привелигерованном режиме или с препиской **do** в режиме глобальной конфигурации.



#### Команды проверки

* **Общие**

  * `show interface [имя интерфейса]` - без указания конкретного интерфейса, показывает информацию о все доступных интерфейсах (IP-адрес, MAC, Тип и др.)

  * `show ip route` - список сетевых маршрутов

* **OSPF**

  * `show ip ospf` - сумма параметров OSPF (router-id, ...).
  * `show ip ospf interface` - отображает интерфейсы анонсированных сетей.
  * `show ip ospf neighbor`- указывает устройства с которыми установлено соседство.
  * `show ip ospf route` - список маршрутов и источников, откуда они были получены